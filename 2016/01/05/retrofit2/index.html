<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Retrofit2 | Wiolem</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Retrofit2</h1><a id="logo" href="/.">Wiolem</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Retrofit2</h1><div class="post-meta">Jan 5, 2016<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><a data-disqus-identifier="2016/01/05/retrofit2/" href="/2016/01/05/retrofit2/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Retrofit2-简介"><span class="toc-number">1.</span> <span class="toc-text">Retrofit2 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#把-HTTP-API-变成-Java-的接口"><span class="toc-number">1.1.</span> <span class="toc-text">把 HTTP API 变成 Java 的接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发出这个网络请求"><span class="toc-number">1.2.</span> <span class="toc-text">发出这个网络请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Retrofit2-引入"><span class="toc-number">2.</span> <span class="toc-text">Retrofit2 引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Retrofit2-使用"><span class="toc-number">3.</span> <span class="toc-text">Retrofit2 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用步骤"><span class="toc-number">3.1.</span> <span class="toc-text">使用步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#替换原则"><span class="toc-number">3.2.</span> <span class="toc-text">替换原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拓展和参考资料"><span class="toc-number">4.</span> <span class="toc-text">拓展和参考资料</span></a></li></ol></div></div><div class="post-content"><h2 id="Retrofit2-简介"><a href="#Retrofit2-简介" class="headerlink" title="Retrofit2 简介"></a>Retrofit2 简介</h2><p>Retrofit2 是 Square 公司推出的类型安全的 Http 客户端，主要用于 Android 和 Java。Retrofit 可以利用接口、方法和注解参数（parameter annotations）来声明式定义一个请求应该如何被创建，将网络请求变成方法的调用，使用起来非常简洁方便。 Retrofit 要求用在 Java 7 or Android 2.3 以上版本上，先简单了解下 Retrofit 的使用步骤：</p>
<h3 id="把-HTTP-API-变成-Java-的接口"><a href="#把-HTTP-API-变成-Java-的接口" class="headerlink" title="把 HTTP API 变成 Java 的接口"></a>把 HTTP API 变成 Java 的接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>&#123;</div><div class="line">  <span class="meta">@GET</span>(<span class="string">"users/&#123;user&#125;/repos"</span>)</div><div class="line">  Call&lt;List&lt;Repo&gt;&gt; listRepos(<span class="meta">@Path</span>(<span class="string">"user"</span>) String user);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 GithubService 接口中有一个方法 listRepos，这个方法用了 @GET 的方式注解，表明这是一个 GET 请求。在后面的括号中的 users/{user}/repos 是请求的路径，其中的 {user} 表示的是这一部分是动态变化的，它的值由方法的参数传递过来，而这个方法的参数<code>@Path(&quot;user&quot;) String user</code>即是用于替换 {user} 。另外这个方法的返回值是 <code>Call&lt;List&lt;Repo&gt;&gt;</code>，可以看出 Retrofit 用注解的方式来描述一个 Http 网络请求相关的数据，并且根据这个接口创建请求对象。</p>
<h3 id="发出这个网络请求"><a href="#发出这个网络请求" class="headerlink" title="发出这个网络请求"></a>发出这个网络请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用构建者模式创建 Retrofit 对象</span></div><div class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">        .baseUrl(<span class="string">"https://api.github.com/"</span>)</div><div class="line">        .addConverterFactory(GsonConverterFactory.create())</div><div class="line">        .build();</div><div class="line"></div><div class="line">GitHubService service = retrofit.create(GitHubService.class);</div><div class="line">Call&lt;List&lt;Repo&gt;&gt; repos = service.listRepos(<span class="string">"octocat"</span>);</div><div class="line">repos.enqueue(<span class="keyword">new</span> Callback&lt;List&lt;Repo&gt;&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;List&lt;Repo&gt;&gt; call, Response&lt;List&lt;Repo&gt;&gt; response)</span> </span>&#123;</div><div class="line">            </div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;List&lt;Repo&gt;&gt; call, Throwable t)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>a.先是构建了一个 Retrofit 对象，其中传入了 baseUrl 参数，baseUrl 和上面的 GET 方法后面的路径组合起来才是一个完整的 url。除了 baseUrl，还有一个 converterFactory，它是用于把返回的 http response 转换成 Java 对象，对应方法的返回值 Call<list<repo>&gt; 中的 List<repo>&gt;，其中 Repo 是自定义的类。<br>b.接着调用它的 create 方法创建了 GitHubService 的实例，然后就可以调用这个实例的方法来请求网络了。调用 listRepo 方法得到一个 Call 对象，然后可以使用 enqueue 或者 execute 来执行发起请求，enqueue 是异步执行，而 execute 是同步执行。</repo></list<repo></p>
<h2 id="Retrofit2-引入"><a href="#Retrofit2-引入" class="headerlink" title="Retrofit2 引入"></a>Retrofit2 引入</h2><p>在 Module 的 build.gradle 文件中添加 retrofit 相关依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    ....</div><div class="line">    <span class="comment">// 网络访问工具</span></div><div class="line">    compile <span class="string">'com.squareup.retrofit2:retrofit:2.1.0'</span></div><div class="line">    compile <span class="string">'com.google.code.gson:gson:2.2.4'</span></div><div class="line">    compile <span class="string">'com.squareup.retrofit2:converter-gson:2.1.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>compile &#39;com.squareup.retrofit2:retrofit:2.1.0&#39;</code> 添加 Retrofit 依赖</li>
<li><code>compile &#39;com.google.code.gson:gson:2.2.4&#39;</code> 添加解析工具的依赖</li>
<li><code>compile &#39;com.squareup.retrofit2:converter-gson:2.1.0&#39;</code> 添加Retrofit和解析工具关联的依赖</li>
</ul>
<h2 id="Retrofit2-使用"><a href="#Retrofit2-使用" class="headerlink" title="Retrofit2 使用"></a>Retrofit2 使用</h2><h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a><strong>使用步骤</strong></h3><p>1)  创建Retorfit.Builder对象，通过Builder指定基本配置信息。 </p>
<p>Retrofit.Builder builder = new Retrofit.Builder();<br>builder.baseUrl(“<a href="http://localhost:8080/" target="_blank" rel="external">http://localhost:8080/</a>“);<br>builder.addConverterFactory(GsonConverterFactory.create());</p>
<p>2)  通过Builder构建Retorfit对象</p>
<p>Retrofit retrofit = builder.build();</p>
<p>3)  配置链接和参数</p>
<p>public interface ResponseInfoAPI {<br>  @GET(“HelloDemo/login”)<br>  Call<responseinfo> login(@Query(“username”) String username,@Query(“password”) String password);<br>}</responseinfo></p>
<ul>
<li>注：ResponseInfo是服务器回复数据封装成的对象。</li>
</ul>
<p>测试链接 : <a href="http://localhost:8080/HelloDemo/login?username=&quot;XiaoMing&quot;&amp;password=&quot;123456" target="_blank" rel="external">http://localhost:8080/HelloDemo/login?username=”XiaoMing”&amp;password=”123456</a>“</p>
<p>4) 完整链接组合</p>
<p>ResponseInfoAPI api = retrofit.create(ResponseInfoAPI.class);</p>
<p>5) 执行联网操作</p>
<p>Call<responseinfo> call =api.login(“Hello”,”123456”);<br>call.enqueue(new Callback<responseinfo>() {<br>​    @Override<br>​    public void onResponse(Response<responseinfo> response, Retrofit retrofit) {<br>​        // 结果处理<br>​    }<br>​    @Override<br>​    public void onFailure(Throwable throwable) {<br>​        // 异常处理<br>​    }<br>});</responseinfo></responseinfo></responseinfo></p>
<p>请求方法:@GET / @POST </p>
<p>URL处理 : 测试链接<a href="http://localhost:8080/TakeoutService/login?username=&quot;XiaoMing&quot;&amp;password=&quot;123456" target="_blank" rel="external">http://localhost:8080/HelloDemo/login?username=”XiaoMing”&amp;password=”123456</a>“</p>
<h3 id="替换原则"><a href="#替换原则" class="headerlink" title="替换原则"></a><strong>替换原则</strong></h3><p>1、@Path - 替换参数</p>
<p>@GET(“/group/{id}/users”)</p>
<p>public Call<list<user>&gt; groupList(@Path(“id”) int groupId);</list<user></p>
<p>2、@Query - 添加查询参数</p>
<p>@GET(“/group/{id}/users”)</p>
<p>public Call<list<user>&gt; groupList(@Path(“id”) int groupId, @Query(“sort”) String sort);</list<user></p>
<p>3、@QueryMap - 如果有多个查询参数，把它们放在Map中</p>
<p>@GET(“/group/{id}/users”)</p>
<p>public Call<list<user>&gt; groupList(@Path(“id”) int groupId, @QueryMap Map<string, string=""> options);</string,></list<user></p>
<h2 id="拓展和参考资料"><a href="#拓展和参考资料" class="headerlink" title="拓展和参考资料"></a>拓展和参考资料</h2><ul>
<li><a href="http://blog.csdn.net/ghost_programmer/article/-details/52372065" target="_blank" rel="external">Say hello to retrofit</a></li>
<li><a href="https://github.com/square/retrofit" target="_blank" rel="external">retrofit github</a> </li>
<li><a href="http://square.github.io/retrofit/" target="_blank" rel="external">retrofit 官网</a></li>
<li><a href="https://segmentfault.com/a/1190000006767113" target="_blank" rel="external">Android Retrofit源码解析</a></li>
</ul>
</div><div class="tags"><a href="/tags/第三方开源库/">第三方开源库</a><a href="/tags/Retrofit2/">Retrofit2</a><a href="/tags/网络请求/">网络请求</a></div><div class="post-nav"><a href="/2016/01/15/Java基础总结/" class="pre">Java基础知识</a><a href="/2016/01/01/hello_wiolem/" class="next">Hello Wiolem</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'wiolem.disqus.com';
var disqus_identifier = '2016/01/05/retrofit2/';
var disqus_title = 'Retrofit2';
var disqus_url = 'http://yoursite.com/2016/01/05/retrofit2/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//wiolem.disqus.com.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Front-End/">Front End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Wiolem/">Wiolem</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/BFC/" style="font-size: 15px;">BFC</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Gulp/" style="font-size: 15px;">Gulp</a> <a href="/tags/Promise/" style="font-size: 15px;">Promise</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/后端/" style="font-size: 15px;">后端</a> <a href="/tags/SASS/" style="font-size: 15px;">SASS</a> <a href="/tags/Dagger2/" style="font-size: 15px;">Dagger2</a> <a href="/tags/第三方开源库/" style="font-size: 15px;">第三方开源库</a> <a href="/tags/依赖注入/" style="font-size: 15px;">依赖注入</a> <a href="/tags/GitHub/" style="font-size: 15px;">GitHub</a> <a href="/tags/defineProperty/" style="font-size: 15px;">defineProperty</a> <a href="/tags/面向对象/" style="font-size: 15px;">面向对象</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/Retrofit2/" style="font-size: 15px;">Retrofit2</a> <a href="/tags/网络请求/" style="font-size: 15px;">网络请求</a> <a href="/tags/兼容/" style="font-size: 15px;">兼容</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/BUG/" style="font-size: 15px;">BUG</a> <a href="/tags/underscore/" style="font-size: 15px;">underscore</a> <a href="/tags/模块化/" style="font-size: 15px;">模块化</a> <a href="/tags/jsonp/" style="font-size: 15px;">jsonp</a> <a href="/tags/跨域/" style="font-size: 15px;">跨域</a> <a href="/tags/元素居中/" style="font-size: 15px;">元素居中</a> <a href="/tags/移动端/" style="font-size: 15px;">移动端</a> <a href="/tags/云音乐/" style="font-size: 15px;">云音乐</a> <a href="/tags/Ajax/" style="font-size: 15px;">Ajax</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/03/if (a === 1 && b === 2 && c === 3) console.log('success')/">if (a === 1 && b === 2 && c === 3) console.log('success')</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/10/JavaScript 运行机制之Promise、setTimeout/">JavaScript 运行机制之Promise、setTimeout</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/10/原生 JavaScript 封装 jsonp 请求/">原生 JavaScript 封装 jsonp 请求</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/函数节流与函数防抖/">underscore---函数节流和函数防抖</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/18/Git 花式 commit/">Git 花式 commit - enjoy 😜</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/15/开发移动端中遇到的单位/">移动端中的遇到的烦人单位</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/15/Sass/">SASS-CSS扩展语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/我一定会爱上你/">我一定会爱上你</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/20/前端模块化（AMD CMD）/">前端模块化（AMD和CMD）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/15/Gulp 前端自动化工具/">Gulp 前端自动化工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://material.uplabs.com/" title="Material.Uplabs" target="_blank">Material.Uplabs</a><ul></ul><a href="https://dribbble.com/" title="Dribbble" target="_blank">Dribbble</a><ul></ul><a href="https://juejin.im/timeline/" title="JueJin" target="_blank">JueJin</a><ul></ul><a href="http://wiki.jikexueyuan.com/" title="Wiki.JiKeXueYuan" target="_blank">Wiki.JiKeXueYuan</a></div><div class="widget"><div class="widget-title"><i class="fa fa-external-music"> 网易云音乐</i></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=534494933&auto=1&height=66"></iframe></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Wiolem.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>